@startuml

title sd_zone_update

[-> AdministrationWebApp: //open zone update form//

activate AdministrationWebApp
AdministrationWebApp ->> RemoteServicesInterface: askZoneManagementUpdateForm(adminId) // no "ask form", but "ask list"????????????

activate RemoteServicesInterface
AdministrationWebApp <<-- RemoteServicesInterface
RemoteServicesInterface ->> ZoneManagement: askZoneManagementUpdateForm(adminId)

activate ZoneManagement
RemoteServicesInterface <<-- ZoneManagement

deactivate RemoteServicesInterface
ZoneManagement -> NotificationSystem: sendZoneUpdateForm()

activate NotificationSystem
ZoneManagement <<-- NotificationSystem

deactivate ZoneManagement
NotificationSystem ->> AdministrationWebApp: sendZoneUpdateForm()
NotificationSystem <<-- AdministrationWebApp

deactivate NotificationSystem

[<- AdministrationWebApp: //show form//
[-> AdministrationWebApp: //data insertion// //inside loop!!!!!! or data are insertend only once, even if incorrect!!!!!!!!

AdministrationWebApp ->> RemoteServicesInterface: sendData(data)

activate RemoteServicesInterface
AdministrationWebApp <<-- RemoteServicesInterface
RemoteServicesInterface ->> ZoneManagement: sendData(data)

activate ZoneManagement
RemoteServicesInterface <<-- ZoneManagement

deactivate RemoteServicesInterface
loop until confirmation or exit
	ZoneManagement -> ZoneManagement: checkZonesConsistency(data)
	alt correct data
		ZoneManagement ->> NotificationSystem: askPassword()
		
		activate NotificationSystem
		ZoneManagement <<-- NotificationSystem
		NotificationSystem ->> AdministrationWebApp: askPassword()
		NotificationSystem <<-- AdministrationWebApp
		
		deactivate NotificationSystem
		[<- AdministrationWebApp: askPassword()
		[-> AdministrationWebApp: insertPassword(psw)
		AdministrationWebApp --> RemoteServicesInterface: sendPassword(adminId, psw)
		AdministrationWebApp <<-- RemoteServicesInterface
		RemoteServicesInterface ->> ZoneManagement: sendPassword(adminId, psw)
		RemoteServicesInterface <<-- ZoneManagement
		ZoneManagement -> ZoneManagement: ckeckPassword(psw)
		alt password confirmed
			ZoneManagement -> DataAccessUtilities: updateZone(...)
			
			activate DataAccessUtilities
			DataAccessUtilities -> DBMS: update(...)
			
			activate DBMS
			DataAccessUtilities <-- DBMS
			
			deactivate DBMS
			ZoneManagement <-- DataAccessUtilities
			
			deactivate DataAccessUtilities
			ZoneManagement ->> NotificationSystem: confirm()
			
			activate NotificationSystem
			ZoneManagement <<-- NotificationSystem
			NotificationSystem ->> AdministrationWebApp: confirm()
			NotificationSystem <<-- AdministrationWebApp
			
			deactivate NotificationSystem
		else password rejected
			ZoneManagement ->> NotificationSystem: reject()
			
			activate NotificationSystem
			ZoneManagement <<-- NotificationSystem
			NotificationSystem ->> AdministrationWebApp: reject()
			NotificationSystem <<-- AdministrationWebApp
			
			deactivate NotificationSystem
		end
	else wrong data
		ZoneManagement ->> NotificationSystem: dataError(...)
			
			activate NotificationSystem
			ZoneManagement <<-- NotificationSystem
			NotificationSystem ->> AdministrationWebApp: dataError(...)
			NotificationSystem <<-- AdministrationWebApp
			
			deactivate NotificationSystem
	end
end

deactivate AdministrationWebApp
deactivate ZoneManagement
	
@enduml